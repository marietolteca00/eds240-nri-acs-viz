---
title: "FEMA National Risk Index (NRI)"
description: "Visualizing FEMA NRI Counties in California Compared To Other States"
author: "Marie Tolteca"
date: 2/04/2025
toc: true
code-line-numbers: true
editor_options: 
  chunk_output_type: console
---

# Library Packages
```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(here)
```

# Read in Data
```{r, warning=FALSE,message=FALSE}
nri <- read_csv(here("data","National_Risk_Index_Counties_807384124455672111.csv")) %>% 
  janitor::clean_names()
```
# Exploration
```{r}
# Check outputs in state_name
unique(nri$state_name)

unique(nri$state_name_abbreviation)

```

# Data Wrangle
```{r, output = FALSE}
# Removing rows containing data from U.S territories and Washington D.C.
nri_counties <- nri |> 
  filter(!state_name %in% c("American Samoa", 
                            "Northern Mariana Islands", 
                            "Virgin Islands", 
                            "District of Columbia", 
                            "Guam", 
                            "Puerto Rico"), 
         # Only selecting counties, removing planning areas, borough, census area, municipality etc.  
         county_type == "County") |> 
  # Reordering state name abbreviation based on median national risk index score composite values 
  mutate(state_name_abbreviation = reorder(state_name_abbreviation, 
                                            national_risk_index_score_composite, 
                                            median),
         # Create highlight variable for CA to be used in ggplot
         highlight = state_name_abbreviation == "CA")

# Calculate Medians
national_median <- median(nri_counties$national_risk_index_score_composite)
ca_median <- median(nri_counties$national_risk_index_score_composite[nri_counties$state_name_abbreviation == "CA"])

```

# Plot
```{r}
#| fig-cap: "Comparison of FEMA National Risk Index (NRI) scores across U.S. states. California counties are highlighted in cyan, with a red dashed vertical line indicating California’s median score."
#| fig-alt: "Boxplots of county-level National Risk Index scores by state. California, colored in cyan, counties have a median score of approximately 95, which is substantially higher than the national median of about 50."
#| fig-height: 12
#| fig-width: 8
#| fig-asp: 1.3


# Create visualization
ggplot(nri_counties, aes(x = national_risk_index_score_composite, 
           y = state_name_abbreviation,
           fill = highlight)) +
  # Remove outliers, makes plot cleaner 
  geom_boxplot(outlier.shape = NA) +
  # Color CA boxplot 
  scale_fill_manual(values = c("gray", "cyan"), guide = "none") +
  # Add vertical line at median national risk index score composite values of all states 
  geom_vline(xintercept = national_median, linetype = "dashed", alpha = 0.5, linewidth = .5) +
  # Add label for median line
  annotate("text", x = 25, y = 45, label = "National Median", 
           hjust = -0.1, size = 3) +
  annotate("text", x = 80, y= 2, label = "CA Median",
           hjust = -0.1, size = 3)+
   geom_vline(xintercept = ca_median, linetype = "dashed", linewidth = .5, color = "firebrick") +
  theme_minimal() +
  labs(x = "National Risk Index Score", 
       y = NULL, 
       title = "Comparison of FEMA National Risk Index Scores by State", 
       subtitle = "California counties highlighted relative to other U.S. states",
       caption = "California counties have the highest median National Risk Index scores among U.S. states (≈ 95),nearly double the national median(≈ 50).\nData: FEMA National Risk Index (2025 Release).") +
  theme(panel.grid.major.y = element_blank(),
        panel.grid.minor = element_blank(),
        plot.caption = element_text(hjust = 0.5, size = 9)) # Center subtitle

```


# Questions
1. What are your variables of interest and what kinds of data (e.g. numeric, categorical, ordered, etc.) are they (a bullet point list is fine)?
The variables of interest are 
- `state_name` (character, categorical), 
- `state_name_abbreviations`(character, categorical), and 
- `national_risk_index_state_percentile_composite`(numeric) 

2. How did you decide which type of graphic form was best suited for answering the question? What alternative graphic forms could you have used instead? Why did you settle on this particular graphic form?
After I did the exploration, my initial thought a boxplot was a great idea because of the numeric variable and  the characters. I then overlayed a jitter plot to show the dispersion of the data better and show its distribution. I could have used a density ridge plot, however when I attempted to make one I felt the distribution of each variable was squished and not ideal.

3. Summarize your main finding in no more than two sentences.
California counties have among the highest FEMA National Risk Index scores compared to other states, with a median of 94.85. The lowest scoring states have median NRI scores around 10–15.

4. What modifications did you make to this visualization to make it more easily readable?
I highlighted CA with a different color to make it easily identifiable. Jitter points were added to show the distribution of level scores. The boxplot displays the median and interquartile range for each state.

5. Is there anything you wanted to implement, but didn’t know how? If so, please describe.
I would have liked to remove most of the states and keep only the top five so it is less cluttered.
